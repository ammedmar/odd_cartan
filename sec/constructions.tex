% !TEX root = ../odd_cartan.tex

\section{Effective constructions}\label{s:effective}

We now turn to the effective construction of natural Cartan relators for the cochains of simplicial sets, or, more generally, Barratt--Eccles algebras.

\subsection{Barratt--Eccles operad}

Let $\Set$ and $\sSet$ denote the categories of sets and simplicial sets respectively.
The symmetric monoidal functor $\EE \colon \Set \to \sSet$ is defined on objects by $\EE X_n = X^{n+1}$ with
\[
\begin{split}
	\face_i(x_0,\dots,x_n) &= (x_0,\dots,\widehat{x}_i,\dots,x_n), \\
	\dege_i(x_0,\dots,x_n) &= (x_0, \dots, x_i, x_i, \dots, x_n),
\end{split}
\]
and on morphisms by $\EE f_n = f^{\times n}$.
We notice that if $X$ is equipped with a group action then $\EE X$ is as well with
\[
(x_0,\dots,x_n) \cdot g = (x_0 \cdot g, \dots, x_n \cdot g).
\]

The usual block permutation map
\[
\bcirc_{\sym} \colon \sym_r \times \sym_{s_1} \times \cdots \times \sym_{s_r} \to \sym_{s_1+\dots+s_r}
\]
provides $\sym = \{\sym_r\}_{r>0}$ with the structure of an operad in $\Set$.

The simplicial Barratt--Eccles operad $\rE\sym$ is obtained by applying the functor $\EE$ to the operad $\sym$.
We denote its composition by
\[
\bcirc_{\rE\sym} \colon
\rE\sym(r) \times \rE\sym(s_1) \times\dots\times \rE\sym(s_r) \to
\rE\sym(s_1+\dots+s_r).
\]

The (algebraic) Barratt--Eccles operad $\BE$ is defined by $\BE(r) = \chains\EE\sym_r$ with composition given by
\[
\bcirc_{\BE} \defeq \bcirc_{\EE} \circ \EZ \colon \BE(r) \ot \BE(s_1) \ot\dotsb\ot \BE(s_r) \to \BE(s_1+\dots+s_r).
\]
It is an $E_\infty$-operad.
For any simplicial set $X$, Berger and Fresse \cite{berger2004combinatorial} explicitly constructed a natural operad morphism
\[
\phi \colon \BE \to \End(\cochains(X))
\]
on its (normalized) cochains.
Since only the existence of this effective construction will be used here, we refer to the original source for details, and to the specialized computer algebra system \texttt{ComCH} for an implementation.

\subsection{May--Steenrod structure on Barratt--Eccles algebras}\label{ss:may-steenrod on barratt-eccles}

To provide the cochains of simplicial sets, or more generally any $\BE$-algebra, with a natural May--Steenrod structure, it suffices to define a $\cyc$-equivariant quasi-isomorphism
\[
\iota \colon \cW \to \BE.
\]
We recall from \cite{medina2021may_st} a closed form formula for one such map which factors through the $\cyc$-module
\[
\cC = \{\chains\EE\cyc_r\}_{r\in\N}.
\]
For $r,n\in\N$, let
\begin{equation*}
	\iota(e_{n}) =
	\begin{cases}
		\displaystyle{\sum_{s_1, \dots, s_m}} \big(0, {s_1}, {s_1+1}, {s_2}, \dots, {s_{m}}, {s_{m}+1} \big) & n = 2m, \\
		\displaystyle{\sum_{s_1, \dots, s_m}} \big(0, 1, {s_1}, {s_1+1}, \dots, {s_{m}}, {s_{m}+1} \big) & n = 2m+1,
	\end{cases}
\end{equation*}
where the sum is over all $s_1, \dots, s_m \in \{0, \dots, r-1\} \cong \cyc_r$.
Please consult \cref{f:small values of psi} for a few examples.

\begin{table}
	\centering
	\input{aux/table}
	\caption{The elements $\psi(e_n)$ for small values of $r$ and $n$.}
	\label{f:small values of psi}
\end{table}

Given a Barratt--Eccles algebra $\phi \colon \BE \to \End(A)$ we will consider $A$ as a May--Steenrod complex with the structure defined by $\phi$ and $\iota$.

\subsection{Main diagram}

Our goal is to construct a natural Cartan relator for $\BE$-algebras, that is to say, a natural $\cyc$-equivariant homotopy $H \colon \cW \to \End(A)^\vee$ from $G$ to $\tau \comp F$ for any $\BE$-algebra $A$.
We will do so by constructing $\cyc$-equivariant chain homotopies $K_1$, $K_2$, and $K_3$ making the following diagram commute:
\begin{equation}\label{d:big diagram}
	\input{sec/diagram}
\end{equation}
where $e \in \sym_2$ is the identity element denoting, abusively, the element $(e) \in (\chains\EE\sym_2)_0$.

\begin{lemma}
	The top composition in diagram \eqref{d:big diagram} agrees with $\tau \circ F^r$ whereas the bottom one does so with $G^r$.
\end{lemma}

\begin{proof}
	Let us write $\cO$ instead of $\End(A)$ for a Barratt--Eccles algebra $A$ as in  \cref{ss:cartan_relators}, where the maps $\tau \circ F_\psi^r$ and $G_\psi^r$ are defined.
	The first claim is equivalent to the commutativity of
	\[
	\begin{tikzcd}
		&
		\BE(r) \arrow[d,"\phi"] \arrow[r,"\id\, \ot\, e^{\ot r}"] &[10pt]
		\BE(r) \ot \BE(2)^{\ot r} \arrow[d,"\phi^{\ot 3}"] \arrow[r,"\bcirc_{\BE}"] &
		\BE(2r) \arrow[d,"\phi"] \\
		\cW(r) \arrow[r,"\psi"] \arrow[ur, in=180, out=60,"\iota"] &
		\cO(r) \arrow[r,"\id\, \ot\, \psi_0^{\ot r}"] &
		\cO(r) \ot \cO(2)^{\ot r} \arrow[r,"\bcirc_{\cO}"] &
		\cO(2r),
	\end{tikzcd}
	\]
	where the bottom composition is $F_\psi^r$\,, whereas the second is equivalent to the commutativity of
	\[
	\begin{tikzcd}
		&[-10pt] &
		\BE(r)^{\ot2} \arrow[d,"\phi^{\ot 2}"] \arrow[r,"e\,\ot\,\id"] &[10pt]
		\BE(2) \ot \BE(r)^{\ot2} \arrow[d,"\phi^{\ot 3}"] \arrow[r,"\bcirc_{\BE}"] &
		\BE(2r) \arrow[d,"\phi"] \\
		\cW(r) \arrow[r,"\Delta"] &
		\cW(r)^{\ot 2} \arrow[r,"\psi^{\ot 2}"] \arrow[ur, in=180, out=60,"\iota^{\ot 2}"] &
		\cO(r)^{\ot 2} \arrow[r,"\psi_0\,\ot\,\id"] &
		\cO(2) \ot \cO(r)^{\ot 2} \arrow[r,"\bcirc_{\cO}"] &
		\cO(2r),
	\end{tikzcd}
	\]
	where the bottom composition is $G_\psi^r$\,.
	Both of these diagrams are commutative since $\phi$ is an operad map and, by definition, $\psi = \phi \comp \iota$.
\end{proof}

\subsection{Comparing $F$ and $\phi \comp \chains\EE f \comp \iota$}

Let us focus on the following part of Diagram~\eqref{d:big diagram}:
\[
\begin{tikzcd}[row sep=small]
	\BE(r) \arrow[r,"\id \ot e^{\ot r}"] &[5pt]
	\BE(r) \ot \BE(2)^{\ot r} \arrow[d,"\bcirc_{\BE}"] \\ &
	\BE(2r) \arrow[d, "\tau"] \\
	\cC(r) \arrow[uu,hook] \arrow[r,"\tau \comp \chains\EE f"] & \BE(2r).
\end{tikzcd}
\]
Its commutativity is a consequence of the proof of the following.

\begin{lemma}
	For any Barratt--Eccles algebra, with its canonical May--Steenrod structure, we have
	\[
	\tau \comp F_\psi = \tau \comp \phi \comp \chains\EE f \comp \iota.
	\]
\end{lemma}

\begin{proof}
	Consider the diagram
	\begin{equation*}\label{d:F and f}
		\begin{tikzcd}[column sep=small,row sep=tiny]
			&& \chains\EE\sym_r \ot (\chains\EE\sym_2)^{\ot r}
			\arrow[dr,"\bcirc_{\BE}",out=0,in=120]
			\arrow[dd,"\EZ"] &&[10pt] \\
			\cW(r) \arrow[r,"\iota"] &
			\chains\EE\sym_r
			\arrow[ur,"\id \ot e^{\ot r}", out=60,in=180]
			\arrow[dr,"\chains\EE(\id \times e^r)"',out=-60,in=180]
			& & \chains\EE\sym_{2r} \arrow[r,"\tau\comp\phi"] &
			\End(A^{\ot r}, A). \\
			&& \chains\EE(\sym_r \times \sym_2^r)
			\arrow[ur, "\chains\EE(\bcirc_{\EE})"', out=0,in=-120]
			&
		\end{tikzcd}
	\end{equation*}
	Its top composition is $\tau \comp F_\psi^r$ and its bottom composition is $\tau \comp \phi \comp \chains\EE f \comp \iota$.
	Additionally, it is commutative since for any pair of simplicial sets $X,Y$ and simplices $y \in Y_0$ and $x \in X$ one has $\EZ(x \ot y) = x \times y$.
\end{proof}

\subsection{The homotopy $K_1$}\label{ss:K1}

Let us focus on the following part of Diagram \eqref{d:big diagram}:
\[
\begin{tikzcd}[column sep=large]
	\cC(r)
	\arrow[r,bend left,"\tau \comp \chains\EE f"]
	\arrow[r,bend right,"\chains\EE g"']
	\arrow[r,phantom,"K_1^r"]
	& \BE^\vee(r).
\end{tikzcd}
\]

\begin{definition}
	Let $K_1 \colon \cC \to \BE^\vee$ be defined by
	\[
	K_1(a_0,\dots,a_n) =
	\sum_{i=0}^n \ (-1)^i (g(a_o), \dots, g(a_i), f(a_i) \tau, \dots, f(a_n) \tau).
	\]
\end{definition}

\begin{lemma}
	The map $K_1$ is a $\cyc$-equivariant homotopy from $\chains \EE g$ to $\tau \comp \chains \EE f$.
\end{lemma}

\begin{proof}
	\TBW
	\[
	\bd \circ K_1 + K_1 \circ \bd = \tau \comp \chains \EE f - \chains \EE g,
	%	\qquad\text{and}\qquad
	\qquad
	K_1 \circ \rho = g(\rho) \circ K_1.
	\]
	\cref{eq:K1_homotopy} is verified through a direct computation, whereas \cref{eq:K1_equivariant} follows from the identity $f(\rho) \tau = \tau g(\rho)$.
\end{proof}

\subsection{The homotopy $K_2$}

Let us focus on the following part of Diagram~\eqref{d:big diagram}:
\begin{equation}\label{d:K2}
	\begin{tikzcd}[row sep=small]
		\cC(r)
		\arrow[r,"\chains\EE g"]
		\arrow[d,"\Delta_{\AW}"']
		\arrow[ddr,phantom,"K_2^r",shift left=0pt]
		&[5pt] \BE(2r)
		\\
		\cC(r)^{\ot 2}
		\arrow[d,hook] & \\
		\BE(r)^{\ot 2}
		\arrow[r,"e\, \ot\, \id"]
		& \BE(2) \ot \BE(r)^{\ot 2}.
		\arrow[uu,"\bcirc_\BE"']
	\end{tikzcd}
\end{equation}
We will show that its commutes up the following $\cyc$-equivariant homotopy.

\begin{definition}
	Let $K_2 \colon \cC \to \BE^\vee$ be the composition
	\[
	\chains\bcirc_{\EE\sym} \circ \Shi \circ \chains\EE(e \times \id) \circ \chains\EE\rD.
	\]
\end{definition}

\begin{lemma}
	The map $K_2$ is a $\cyc$-equivariant homotopy from $\bcirc_{\BE} \comp (e \ot \id) \comp \Delta_{\AW}$ to $\chains\EE g$.
\end{lemma}

\begin{proof}
	We need to prove the following identities:
	\begin{align}
		\label{eq:K2_homotopy}
		\bd K_2 &=  \chains\EE g - \bcirc_{\BE} \comp (e \ot \id) \comp \Delta_{\AW}\\
		\label{eq:K2_equivariant}
		K_2 \circ \rho &= g(\rho) \circ K_2.
	\end{align}
	Since $\bd \Shi = \id - \EZ \comp \AW$ we have that
	\[
	\bd K_2 =
	\chains\bcirc_{\EE\sym} \circ \chains\EE(e \times \id) \circ \chains\EE\rD -
	\chains\bcirc_{\EE\sym} \circ \EZ \comp \AW \circ \chains\EE(e \times \id) \circ \chains\EE\rD.
	\]
	Recall that $g$ is the composition $\cyc_r \hookrightarrow \sym_r \xra{\rD} \sym_r^{\times 2} \xra{e \times \id} \sym_2 \times \sym_r^{\times 2} \xra{\bcirc_{\sym}} \sym_{2r}$\,, and that $\bcirc_{\BE} = \chains\bcirc_{\EE\sym} \comp \EZ$, so
	\[
	\bd K_2 =
	\chains\EE g -
	\bcirc_{\BE} \comp \AW \circ \chains\EE(e \times \id) \circ \chains\EE\rD.
	\]
	Recall that $\Delta_{\AW} = \AW \comp \chains\EE\rD$.
	Since for any triple of simplices $x,y,z$ we have $\AW(x \times y \times z) = x \ot \AW(y \times z)$ if $x$ is a $0$-simplex, we have
	\[
	\bd K_2 =
	\chains\EE g -
	\bcirc_{\BE} \comp \chains\EE(e \times \id) \comp \Delta_{\AW}
	\]
	as stated in the first identity to prove.
	This computation is summarized in the following diagram:
	\[
	\hspace*{-4pt}
	\begin{tikzcd}
		\chains\EE\cyc_r
		\rar[hook]
		\arrow[dr,in=180,out=-90,"\Delta_{\AW}"]
		&[-20pt]
		\chains\EE\sym_r
		\rar["\chains\EE\rD"] &[-10pt]
		\chains\EE\sym_r^{\times 2}
		\rar["\chains\EE(e \times \id)"]
		\dar["\AW"'] &[7pt]
		\chains\EE(\sym_2 \times \sym_r^{\times 2})
		\rar["\chains\bcirc_{\EE\!\sym}"]
		\dar["\AW"']
		\drar["\id",out=-10,in=150] &[-5pt]
		\chains\EE\sym_{2r} \\ &
		(\chains\EE\cyc_r)^{\ot 2}
		\arrow[r,hook] &
		\chains\EE\sym_r^{\ \ot 2}
		\rar["e \,\ot\, \id"] &
		\chains\EE\sym_2 \ot \chains\EE\sym_r^{\ \ot 2}
		\rar["\EZ"]
		\uar["\Shi",phantom,shift right=30pt] &
		\chains\EE(\sym_2 \times \sym_r^{\times 2}).
		\uar["\chains\bcirc_{\EE\!\sym}"']
	\end{tikzcd}
	\]


		so $\chains\EE g$ is the top composition of
	\[
	\chains\EE\cyc_r \hookrightarrow \chains\EE\sym_r \xra{\chains\EE\rD} \chains\EE \sym_r^{\times 2} \xra{\chains\EE(e \times \id)} \chains\EE(\sym_2 \times \sym_r^{\times 2}) \xra{\chains \bcirc_{\EE\sym}} \chains\EE\sym_{2r}.
	\]
	 and that the functor $\EE$ is symmetric monoidal.
	Therefore, the top and bottom compositions of Diagram \eqref{d:K2} agree with those in:

	From this, \cref{eq:K2_homotopy} follows directly.

	as the desired $\cyc_r$-equivariant homotopy.
\end{proof}

\subsection{The homotopy $K_3$}\label{ss:coproduct}

We now study the failure of the $\cyc$-equivariant quasi-isomorphism $\iota$ to preserve coalgebra structures.
More precisely, we will construct a $\cyc$-equivariant homotopy $K_3$ making the following diagram commute:
\begin{equation}\label{d:coproducts}
	\begin{tikzcd}[column sep=large]
			\cW \arrow[r,"\iota"] \arrow[d,"\Delta"'] \arrow[dr,phantom,"K_3"]&
			\cC \arrow[d,"\Delta_{\AW}"] \\
			\cW^{\ot 2} \arrow[r,"\iota^{\ot 2}"'] &
			\cC^{\ot 2}.
		\end{tikzcd}
\end{equation}

Using the bijection $\cyc_r \cong \set{0,\dots,r-1}$, we denote by $\alpha(a_1,\dots,a_\ell)$ the number of increasing consecutive pairs $a_i < a_{i+1}$ in a basis element of $\cC(r)$.
For two such elements $(s_1,\dots,s_j)$ and $(t_1,\dots,t_k)$ we denote respectively by $\varphi(0,s_1,\dots,s_j;t_1,\dots,t_k)$ and $\varphi(1,s_1,\dots,s_j;t_1,\dots,t_k)$ the following expressions in $\cC(r) \ot \cC(r)$:
\[
\alpha(s_1,\dots,s_j,t_1) \cdot
(0,s_1,s_1+1,\dots,s_j,s_j+1) \ot
(t_1,t_1+1,\dots,t_k,t_k+1),
\]
and
\[
- \alpha(s_1-1,\dots,s_j-1,t_1-1) \cdot
(0,1,s_1,s_1+1,\dots,s_j,s_j+1)\otimes (t_1,t_1+1,\dots,t_k,t_k+1).
\]
Then, the homotopy $K_3$ is defined by
\[
\begin{split}
	K_3(e_{2i})  &= \sum \, \varphi(0,s_1,\dots,s_j;t_1,\dots,t_k), \\
	K_3(e_{2i+1}) &= \sum \, \varphi(1,s_1,\dots,s_j;t_1,\dots,t_k),
\end{split}
\]
where the sums are taken over all $s_1,\dots,s_j,t_1,\dots,t_k \in \cyc_r$ with $i+1 = j+k$.
Please consult \cref{f:small values of K} for a few examples.

The verification that $K_3$ is a $\cyc_r$-equivariant homotopy from $(\iota\otimes \iota)\circ \Delta$ to $\Delta_{\AW}\circ \iota$ is done through a somewhat arduous computation presented in \cref{s:postponed}.

\begin{table}
	\centering
	\input{aux/table2}
	\caption{The elements $K_3(e_n)$ for small values of $r$ and $n$. For $r=2$ or $n<2$ all vanish. Notice that the indices are flipped with respect to \cref{f:small values of psi}.}
	\label{f:small values of K}
\end{table}

\subsection{Main construction}

Using Diagram~\eqref{d:big diagram} to bring these constructions together we obtain the following.

\begin{theorem}
	Let $A$ be a Barratt--Eccles algebra with structure map $\phi$.
	Then,
	\[
	H = \phi \circ K_1 \circ \iota \ +\ \phi \circ K_2 \circ \iota \ +\ \phi \circ \bcirc_{\BE} \circ (e \ot \id)\circ K_3
	\]
	is a natural Cartan relator for $A$.
	Therefore, for $i \in \N$ and mod $p$ cocycles $a,b \in A$
	\[
	\bd H(e_i)(a^{\ot p} \ot b^{\ot p}) = C_\psi^p(i)(a, b)
	\]
	where $C_\psi^p(i)(a, b)$ is the lift of the Cartan formula defined in {\rm \cref{ss:cartan_coboundary}}.
\end{theorem}