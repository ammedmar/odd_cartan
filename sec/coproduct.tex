% !TEX root = ../odd_cartan.tex

\appendix
\newpage
\section{The chain map \textit{K}}\label{s:chain homotopy K}

\begin{table}
	\centering
	\input{aux/table2}
	\caption{The elements $K(e_n)$ for small values of $r$ and $n$. For $r=2$ or $n<2$ all vanish. Notice that the indices are flipped with respect to \cref{f:small values of psi}.}
	\label{f:small values of K}
\end{table}


In order to prove that $K \colon W(r) \to \chains\EE\cyc_r \ot \chains\EE\cyc_r$ defined in \cref{ss:coproduct} by the expression
\begin{align}
	\label{eq:homotopy1}
	K(e_{2i})   &= \sum \, \varphi(0,s_1,\dots,s_j;t_1,\dots,t_k), \\
	\label{eq:homotopy2}
	K(e_{2i+1}) &= \sum \, \varphi(1,s_1,\dots,s_j;t_1,\dots,t_k),
\end{align}
is a homotopy between $(\iota\otimes \iota)\circ \Delta$ and $\Delta_{\AW}\circ \iota$ we will proceed as follows: In \cref{l:homotopyK} we will give a general procedure to construct equivariant homotopies, in \cref{l:homotopyK'} we will use this procedure to describe an explicit homotopy between $(\iota\otimes \iota)\circ \Delta$ and $\Delta_{\AW}\circ \iota$. Finally, in \cref{l:homotopyK''}, that explicit homotopy will be shown to coincide with the formulas \eqref{eq:homotopy1} and \eqref{eq:homotopy2}.

\begin{lemma}\label{l:homotopyK}
	Let $G$ be a group, $C$ a bounded-below graded chain complex of free $\Z[G]$-modules with a basis, and $D$ a graded chain complex of $\Z[G]$-modules together with a $\Z$-linear endomorphism $\eta$ satisfying for some chain endomorphism $\varepsilon$ that:
	\begin{enumerate}
		\item $\bd \circ \, \eta + \eta \circ \bd = \id_C - \varepsilon$,
		\item $\varepsilon\circ \eta = 0$.
	\end{enumerate}
	Then, for any pair of $\Z[G]$-linear chain maps $\mu,\nu \colon C \to D$ with $\varepsilon \circ (\mu-\nu) = 0$, the $\Z[G]$-linear map $K \colon C \to D$ recursively defined on basis elements by
	\[
	K(b) = \eta \circ (\mu - \nu - K \circ \bd)(b),
	\]
	satisfies
	\[
	\bd \circ \, K + K \circ \bd = \mu - \nu.
	\]
\end{lemma}

\begin{proof}
	We will use an induction argument.
	Suppressing composition symbols we have
	\begin{align*}
		(\bd K+ K\bd)(b)
		&= \bd \eta(\mu-\nu-K\bd)(b) + K\bd(b) \\
		&= (\id_C - \varepsilon - \eta\bd)(\mu-\nu - K\bd)(b) + K\bd(b).
	\end{align*}
	If $b$ is a cycle we are done since $\varepsilon(\mu-\nu) = 0$ by assumption, in particular if $b$ is of lowest degree.
	Since $\varepsilon \eta = 0$ we have $\varepsilon K \bd(b) \defeq \varepsilon \eta(\mu-\nu-K)(\bd b) = 0$ for any $b$.
	Additionally, by the induction assumption $\bd K (\bd b) = (\mu-\nu-K\bd)(\bd b) = (\mu-\nu)(\bd b)$ we have $\eta \bd (\mu-\nu - K\bd)(b) = 0$.
	Therefore, we are left with
	\begin{align*}
		(\bd K+ K\bd)(b) &=
		\id_C(\mu-\nu-K\bd)(b)+K\bd(b) \\&=
		(\mu-\nu)(b)
	\end{align*}
	as desired.
\end{proof}

We can apply this lemma to obtain a homotopy $K$ making diagram \eqref{d:coproducts} commute.
Specifically, using the same notation as in the lemma, we have $\mu = (\iota \ot \iota) \circ \Delta$ and $\nu = \Delta_{\AW} \circ \iota$ with
\[
\mu,\nu \colon \cW(r) \to \chains\EE\cyc_r \ot \chains\EE\cyc_r
\]
and
\begin{align*}
	\eta \colon \chains\EE\cyc_r \ot \chains\EE\cyc_r &\to \chains\EE\cyc_r \ot \chains\EE\cyc_r \\
	(s_0,\dots,s_j) \ot (t_0,\dots,t_k) &\mapsto (0,s_0,\dots,s_j) \ot (t_0,\dots,t_k),
\end{align*}
with
\[
\varepsilon(a \ot b) =
\begin{cases}
	\rho^0 \ot b & \text{if } \deg(a \ot b) = 0, \\
	\hfil0 & \text{otherwise}.
\end{cases}
\]

Recall that through the bijection $\cyc_r\cong\{0,1,\ldots,r-1\}$ we have that $\cyc_r$ is a group and an ordered set. Consider additionaly the cyclic order on $\cyc_r$, which is a ternary relation given on elements $a,b,c\in \{0,1,\dots,r-1\}$ as follows: $a\prec b\prec c$
if there are representatives $\bar{a},\bar{b},\bar{c}$ of the classes $[a],[b],[c]$ in $\Z_r$ such that $\bar{a}<\bar{b}<\bar{c}<\bar{a}+r$.

\begin{definition}
	Given a sequence $(s_1,\ldots,s_j)$, denote
	\begin{align*}
		s_q^- &= \begin{cases}s_{q-1}+1 & \text{if $q>1$}\\
			s_q^- = 0 & \text{ if $q=1$.}
		\end{cases}
	\end{align*}
\end{definition}


\begin{definition}
	Let us write $\theta_q(0,s_1,\ldots,s_j;t_1,\ldots,t_k)$ for
	\[(0,s_1,s_1+1,\ldots,s_j,s_j+1)\otimes (t_1,t_1+1,\ldots,t_k,t_k+1)\]
	if $s_q^-\prec s_q\prec t_1$ and $0$ otherwise. Let us write $\theta_q(1,s_1,\ldots,s_j;t_1,\ldots,t_k)$ for
	\[(0,1,s_1,s_1+1,\ldots,s_j,s_j+1)\otimes (t_1,t_1+1,\ldots,t_k,t_k+1)\]
	if $s_q^--1\prec s_q-1\prec t_1-1$ and $0$ otherwise.
\end{definition}

\begin{lemma}\label{l:homotopyK'}
	The homotopy $K$ obtained above from \cref{l:homotopyK} has the following form:
	\begin{align} \label{eq:homotopyK'1}
		K(e_{2i}) &= \sum_{j+k = i+1}{\sum_{q=1}^j{\theta_q(0,s_1,\ldots,s_j;t_1,\ldots,t_k)}} \\ \label{eq:homotopyK'2}
		K(e_{2i+1}) &= -\sum_{j+k = i+1}{\sum_{q=1}^j{\theta_q(1,s_1,\ldots,s_j;t_1,\ldots,t_k)}}
	\end{align}
	where the sum is taken over all $s_1,\ldots,s_j,t_1,\ldots,t_k\in \{0,1,\ldots,r-1\}$.
\end{lemma}

\begin{proof}
	We have that
	\begin{align*}
		\mu(e_{2i}) &= \sum_{i=j+k} \iota(e_{2j})\otimes \iota(e_{2k}) + \sum_{i-1=j+k}\sum_{0\leq s<t<r} \rho^s\iota(e_{2j+1})\otimes \rho^t\iota(e_{2k+1}) \\
		\mu(e_{2i+1}) &= \sum_{i=j+k} \iota(e_{2j})\otimes \iota(e_{2k+1}) + \iota(e_{2j+1})\otimes \rho \iota(e_{2k}),
	\end{align*}
	and that\footnote{The only thing that is used about $\nu$ is that $\eta\circ \nu = 0$ always. One could replace the definition of $\nu(e_i)$ here by this observation. What do you think?}
	\begin{align*}
		\nu(e_{2i}) =&\  (0)\otimes(0,s_1,s_1+1,\ldots,s_k,s_k+1) \\
		&+ \sum_{k=1}^i(0,s_1,s_1+1,\ldots,s_k)\otimes(s_k,s_k+1\ldots,s_i,s_i+1) \\
		&+ \sum_{k=1}^i(0,s_1,s_1+1,\ldots,s_k,s_{k+1})\otimes(s_k+1\ldots,s_i,s_i+1) \\
		\nu(e_{2i+1}) =&\ (0)\otimes(0,1,s_1,s_1+1,\ldots,s_k,s_k+1) \\
		&+ (0,1)\otimes(1,s_1,s_1+1,\ldots,s_k,s_k+1) \\
		&+ \sum_{k=1}^i(0,1,s_1,s_1+1,\ldots,s_k)\otimes(s_k,s_k+1\ldots,s_i,s_i+1) \\
		&+ \sum_{k=1}^i(0,1,s_1,s_1+1,\ldots,s_k,s_{k+1})\otimes(s_k+1\ldots,s_i,s_i+1).
	\end{align*}
	Let us proceed by induction. In degree $0$ we have that $\mu(e_0) = \nu(e_0) = 0\otimes 0$, therefore we have that
	\[K(e_0) = \eta\circ (\mu-\nu-K\circ\partial)(e_0) = 0.\]
	which agrees with \eqref{eq:homotopyK'1} for $i=0$. Assume now that we have proven that the homotopy has that form up to degree $2i$ with $i\geq 0$. Then
	\[K(e_{2i+1}) = \eta\circ (\mu-\nu-K\circ\partial)(e_{2i+1}).\]
	Since $\eta\circ \nu(e_{2i+1}) = 0$ and $\eta\circ\mu(e_{2i+1}) = 0$, we are left with
	\[-\eta\circ K\circ\partial(e_{2i+1}) = -\eta\circ K (\rho e_{2i+1}) + \eta\circ K (e_{2i+1}).
	\]
	The second summand vanishes, because all terms in $K(e_{2i+1})$ start with $0$, and the first summand is precisely the formula \eqref{eq:homotopyK'2}.

	Assume now that we have proven that the homotopy has that form up to degree $2i-1$ with $i>0$. Then
	\[K(e_{2i}) = \eta\circ (\mu-\nu-K\circ\partial)(e_{2i}).\]
	Again, $\eta\circ\nu(e_{2i}) = 0$, but now a careful look reveals that
	\begin{equation}\label{eq:hK1}\eta\circ\mu(e_{2i}) = \sum_{j+k=i+1}\theta_1(0,s_1,\ldots,s_j;t_1,\ldots,t_j).
	\end{equation}
	Regarding the summand $\eta\circ K\circ \partial(e_{2i})$, we have
	\[\eta(N\theta_q(1,s_1,\ldots,s_j,t_1,\ldots,t_k)) = \sum_{s_1' = 1}^{r-1}\theta_{q+1}(0,s_1',s_2',\ldots,s_{j+1}';t_1,\ldots,t_k),\]
	where $s_{i+1}' = s_i$ for $i\geq 1$, and therefore
	\begin{align*} \label{eq:hK2}
		-\eta\circ K\circ\partial(e_{2i})
		&= -\eta\left(-\sum_{j+k = i}\sum_{q=1}^j N\theta_q(1,s_1,\ldots,s_j;t_1,\ldots,t_k)\right) \\
		&= \sum_{j+k = i+1}\sum_{q=2}^{j+1}\theta_q(0,s_1,\ldots,s_{j+1};t_1,\ldots,t_k).
	\end{align*}
	Putting together this last formula and \eqref{eq:hK1}, we obtain the formula \eqref{eq:homotopyK'1}.
\end{proof}

\begin{lemma}\label{l:homotopyK''}
	For any two sequences $(s_1,\ldots,s_j)$ and $(t_1,\ldots,t_k)$ of elements of $\{0,1,\ldots,r-1\}$, the following holds:
	\begin{align*}
		\varphi(0,s_1,\ldots,s_j;t_1,\ldots,t_k) &= \sum_{q=1}^j \theta_q(0,s_1,\ldots,s_j;t_1,\ldots,t_k) \\
		\varphi(1,s_1,\ldots,s_j;t_1,\ldots,t_k) &= -\sum_{q=1}^j \theta_q(1,s_1,\ldots,s_j;t_1,\ldots,t_k).
	\end{align*}
\end{lemma}

\begin{proof}
	Observe first that if $s_{i+1} = s_i+1$ for some $i$, or $s_1 = 0$ (in the first case) or $s_1=1$ (in the second case) we get degenerate summands, so we do not treat these cases in the following computations. For a number $a\in \{0,1,\ldots,r-1\}$, we will write $[a]$ for the class of $a$ in $\Z_{r}$.

	{\em First case.} Let $(s_1',\ldots,s'_j)$ be the only sequence of integers such that $s'_i$ is a representative of $[s_i]$ for each $1\leq i\leq j$ and
	\begin{itemize}
		\item $0< s_1'< r$.
		\item $1<s_{i+1}'-s_i'\leq r$ for all $1\leq i<j$.
	\end{itemize}
	Then $\theta_q(0,s_1,\ldots,s_j;t_1,\ldots,t_k)$ will vanish for $q>1$ if and only if the interval $(s_{q-1}',s_q']$ contains a representative of $[t_1]$, and will vanish for $q=1$ if and only if the interval $[0,s_1']$ contains a representative of $[t_1]$. Therefore the number of vanishing summands in $\sum_{q=1}^j\theta_q(0,s_1,\ldots,s_j;t_1,\ldots,t_k)$ equals the number $Q$ of representatives of $[t_1]$ that lie in the interval $[0,s_j']$, which in turn is computed by
	\[
	Q = \begin{cases}
		|\{i\mid s_i\geq s_{i+1}\}| & \text{if $t_1>s_j$} \\
		|\{i\mid s_i\geq s_{i+1}\}|+1 & \text{if $t_1\leq s_j$}.
	\end{cases}
	\]
	Hence, the number of non-vanishing summands in $\sum_{q=1}^j\theta_q(0,s_1,\ldots,s_j;t_1,\ldots,t_k)$ is $j-Q$, which equals $\alpha(s_1,\ldots,s_j,t_1)$.
	%\[\varphi(0,s_1,\ldots,s_j;t_1,\ldots,t_k) = \sum_{q=1}^j\theta_q(0,s_1,\ldots,s_j;t_1,\ldots,t_k).\]

	{\em Second case.} It follows from the definition of $\theta_q$ that the number of non-vanishing summands in $\sum_{q=1}^j \theta_q(1,s_1,\ldots,s_j;t_1,\ldots,t_k)$ equals the number of non-vanishing summands in
	\[\sum_{q=1}^j \theta_q(0,s_1-1,\ldots,s_j-1;t_1-1,\ldots,t_k-1),\] which by the previous case equals $\alpha(s_1-1,\ldots,s_j-1,t_1-1)$.% therefore
	%\[\varphi(1,s_1,\ldots,s_j;t_1,\ldots,t_k) = \sum_{q=1}^j\theta_q(1,s_1,\ldots,s_j;t_1,\ldots,t_k).\qedhere\]
\end{proof}

