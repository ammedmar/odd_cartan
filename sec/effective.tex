% !TEX root = ../odd_cartan.tex

\section{Effective constructions}

In this section we construct explicit Cartan relator for algebras over the Barratt--Eccles operad, of which the cochains of simplicial sets are natural examples.

\subsection{Barratt--Eccles operad}

We review the main constructions introduced by Berger--Fresse in \cite{berger2004combinatorial}.

Let $\Set$ and $\sSet$ denote the categories of sets and simplicial sets respectively.
The symmetric monoidal functor $\EE \colon \Set \to \sSet$ is defined on objects by $\EE X_n = X^{n+1}$ with
\[
\begin{split}
	\face_i(x_0,\dots,x_n) &= (x_0,\dots,\widehat{x}_i,\dots,x_n), \\
	\dege_i(x_0,\dots,x_n) &= (x_0, \dots, x_i, x_i, \dots, x_n),
\end{split}
\]
and on morphisms by $\EE f_n = f^{\times n}$.
We notice that if $X$ is equipped with a group action then $\EE X$ is as well with
\[
(x_0,\dots,x_n) \cdot g = (x_0 \cdot g, \dots, x_n \cdot g).
\]

The usual block permutation map
\[
\bcirc_{\sym} \colon \sym_r \times \sym_{s_1} \times \cdots \times \sym_{s_r} \to \sym_{s_1+\dots+s_r}
\]
defined for any $r,s_1,\dots,s_r \in \N$ provides $\sym = \{\sym_r\}_{r>0}$ with the structure of an operad in $\Set$.

The simplicial Barratt--Eccles operad $\rE\sym$ is obtained by applying the functor $\EE$ to the operad $\sym$.
We denote its composition by
\[
\bcirc_{\rE\sym} \colon \rE\sym(r) \times \rE\sym(s_1) \times\dots\times \rE\sym(s_r) \to \rE\sym(s_1+\dots+s_r)
\]
for any $r,s_1,\dots,s_r \in \N$.

Let $\chains \colon \sSet \to \Ch$ be the functor of (normalized) chains with integer coefficients.
The linear Barratt--Eccles operad $\cE$ is defined by $\cE(r) = \chains\EE(r)$ and
\[
\bcirc_{\cE} \defeq \bcirc_{\EE} \circ \EZ \colon \cE(r) \ot \cE(s_1) \ot\dotsb\ot \cE(s_r) \to \cE(s_1+\dots+s_r)
\]
for any $r,s_1,\dots,s_r \in \N$.

For any simplicial set $X$, Berger and Fresse explicitly constructed a natural operad morphism
\[
\phi \colon \cE \to \End(\cochains(X))
\]
on its (normalized) cochains.
Since only the existence of this effective construction will be used here, we refer to the original source for details, and to the specialized computer algebra system \texttt{ComCH} for an implementation.

\subsection{May--Steenrod structure on Barratt--Eccles algebras}

To provide the cochains of simplicial sets, or more generally any $\cE$-algebra, with a natural May--Steenrod structure, it suffices to define a $\cyc$-module quasi-isomorphism
\[
\iota \colon \cW \to \cE.
\]
We recall from \cite{medina2021may_st} a closed form formula for one such map which factors through the $\cyc$-module $\{\chains\EE\cyc_r\}_{r\in\N}$.
For $r,n\in\N$
\begin{equation*}
	\iota^{r}(e_{n}) = \begin{cases}
		\displaystyle{\sum_{s_1, \dots, s_m}} \big(0, {s_1}, {s_1+1}, {s_2}, \dots, {s_{m}}, {s_{m}+1} \big) & n = 2m, \\
		\displaystyle{\sum_{s_1, \dots, s_m}} \big(0, 1, {s_1}, {s_1+1}, \dots, {s_{m}}, {s_{m}+1} \big) & n = 2m+1,
	\end{cases}
\end{equation*}
where the sum is over all $s_1, \dots, s_m \in \{0, \dots, r-1\}$ and we are simplifying notation by removing $\rho \in \cyc_r \subset \sym_r$.
Please consult \cref{f:small values of psi} for a few examples.

\begin{table}
	\centering
	\input{aux/table}
	\caption{The elements $\psi^r(e_n)$ for small values of $r$ and $n$.}
	\label{f:small values of psi}
\end{table}

\subsection{The lowercase homomorphisms}

We now describe group homomorphisms inducing two chain homotopic $\cyc$-module chain maps.
We will later relate these to the $\cyc$-module chain maps $F_\psi$ and $G_\psi$ associated to the May--Steenrod structure on $\cE$-algebras.
For $r \in \N$, let
\[
\begin{split}
	&f^r \colon \cyc_r \to \sym_r \xra{\id \times e^{\times r}} \sym_r \times \sym_2^{\times r} \xra{\bcirc_{\sym}} \sym_{2r}, \\
	&g^r \colon \cyc_r \to \sym_r \xra{e \times \mathrm{diag}} \sym_2 \times \sym_r \times \sym_r \xra{\bcirc_{\sym}} \sym_{2r}.
\end{split}
\]
Explicitly, if $\rho = (1,2,\dots,r)$ in $\sym_r$ then in $\sym_{2r}$
\begin{align*}
	f^r(\rho) &= (1,3,\dots,2r-1)(2,4,\dots,2r), \\
	g^r(\rho) &= (1,2,\dots,r)(r+1,r+2,\dots,2r).
\end{align*}
We notice that
\begin{equation}\label{eq:conjugation of little maps}
	f^r(\rho) \tau = \tau g^r(\rho)
\end{equation}
where $\tau$ is as in \cref{ss:reordering}.
We obtain two $\cyc$-module chain maps $\chains\EE f$ and $\chains\EE g$ where the $\cyc_r$ action on $\chains\EE\sym_{2r}$ is induced from Homomorphism \eqref{eq:cyclic to 2-symetric}.

We define a $\cyc$-module chain homotopy $H_{\psi,1}$ between $\chains \EE f \cdot \tau$ and $\chains \EE g$
explicitly as follows.
For $r \in \N$, let $H_{\psi,1}^r \colon \chains\EE\cyc_r \to \chains\EE\sym_{2r}$ be given by
\[
H_{\psi,1}^r(\sigma_0,\dots,\sigma_n) =
\sum_{i=0}^n \ (-1)^i (f^r(\sigma_0) \tau, \dots, f^r(\sigma_i) \tau, g^r(\sigma_i), \dots, g^r(\sigma_n)).
\]
It can be easily verified that $H_{\psi,1}^r$ is a homotopy between $\chains \EE f^r \cdot \tau$ and $\chains \EE g^r$.
To check that it is $\cyc_r$-equivariant we use \cref{eq:conjugation of little maps} and the fact that $\rho$ acts on $\chains\EE\sym_{2r}$ multiplying on the right by $g(\rho)$.

\subsection{Comparing coproducts}

We now study the failure of the $\cyc$-module quasi-isomorphism $\iota$ to preserve coalgebra structures.
More precisely, we will construct a $\cyc$-module chain homotopy $K$ making the following diagram commute
\[
\begin{tikzcd}[column sep=large]
	\cW(r) \arrow[r,"\iota^r"] \arrow[d,"\Delta"] & \chains\EE\cyc_r \arrow[d,"\Delta_{\AW}"]\\
	\cW(r)^{\ot 2} \arrow[r,"(\iota^r)^{\ot 2}"] & \chains\EE\cyc_r^{\ \ot 2}.
\end{tikzcd}
\]
for every $r \in \N$.
Given $K$, the $\cyc$-module map $H_{\psi,2}$ defined for each $r \in \N$ by
\[
H_{\psi,2}^r \colon \cW(p) \xra{K^r} \cE(p)^{\ot 2} \xra{\psi^2_0 \ot \id} \cE(2) \ot \cE(r)^{\ot 2} \xra{\bcirc_{\cE}} \cE(2r)
\]
is a $\cyc$-module chain homotopy between $G_\psi$ and the $\cyc$-module chain map $\widetilde G_\psi$ defined for $r \in \N$ by
\[
\widetilde G_\psi^r \colon \cW(r) \xra{\psi(r)} \cE(r) \xra{\psi^2_0 \ot \Delta_{\AW}} \cE(2) \ot \cE(r)^{\ot 2} \xra{\bcirc_{\cE}} \cE(2r).
\]

To construct $K$ we have the following general procedure.

\begin{lemma}
	Let $G$ be a group, $C$ a non-negatively graded chain complex of free $\Z[G]$-modules with basis, and $h$ a $\Z$-linear map satisfying
	\[
	\bd \circ \, h + h \circ \bd = \id_C - \varepsilon
	\]
	for some chain map $\varepsilon$.
	Then, for any pair of $\Z[G]$-linear chain maps $f,g \colon C \to C$ with $\varepsilon \circ (f-g) = 0$, the recursively defined $\Z[G]$-linear $K \colon C \to C$, given on basis elements by
	\[
	K(b) = h \circ (f - g - K \circ \bd)(b),
	\]
	satisfies
	\[
	\bd \circ \, K + K \circ \bd = f - g.
	\]
\end{lemma}

\begin{proof}
	We have the following computation where we suppressed composition symbols.
	\begin{align*}
		(\bd K + K \bd)(a)
		&= \bd h(f - g - K \bd)(a) + (K \bd)(a) \\
		&= \bd h(f-g)(a) + (\id_C - \bd h)(K \bd)(a) \\
		&= \bd h(f-g)(a) + (h \bd +\, \varepsilon)(K \bd)(a) \\
%
		&= -h(\bd(f(a))) + f(a) -c(f(a))+ h(\bd(g(a))) - g(a)+c(g(a))  + \\
		&\quad + h(\bd(K(\bd(a)))) - K(\bd(a)) + K(\bd(a)) \\
		&= f(a) - g(a) + h\left(-f(\bd a) + g(\bd a) + \bd K(\bd(a)) + K(\bd(\bd(a)))\right) \\
		&= (f - g)(a)
	\end{align*}
\end{proof}

\noindent REFORMULATED PROOF AND LEMMA: NEED TO ADD THE HYPOTHESIS $\epsilon h =0$.

\begin{lemma}
	Let $G$ be a group, $C$ a graded chain complex of $\Z[G]$-modules, and $h$ a $\Z$-linear endomorphism of $C$ satisfying
	\begin{align*}
	\bd \circ \, h + h \circ \bd &= \id_C - \varepsilon
    &
    \varepsilon\circ h &= 0
	\end{align*}
	for some chain endomorphism $\varepsilon$. Let $D$ be a non-negatively graded chain complex of free $\Z[G]$-modules with basis.
	Then, for any pair of $\Z[G]$-linear chain maps $f,g \colon D \to C$ with $\varepsilon \circ (f-g) = 0$, the recursively defined $\Z[G]$-linear $K \colon D \to C$, given on basis elements by
	\[
	K(b) = h \circ (f - g - K \circ \bd)(b),
	\]
	satisfies
	\[
	\bd \circ \, K + K \circ \bd = f - g.
	\]
\end{lemma}

\begin{proof} Let us convene that $K(0) = 0$ in negative degrees, in which case the conclusions of the lemma are trivially satisfied. Let us now suppose that we have proven that $K$ is well-defined for degrees smaller than $\ell$, and let us prove that it is well-defined in degree $\ell$ too. Let $b$ be a basis element in degree $\ell$.
\begin{align*}
    (\partial K+ K\partial)(b)
    &= \partial h(f-g-K\partial)(b) + K\partial(b) \\
    &= (\id_C-\varepsilon-h\partial)(f-g-K\partial)(b)+K\partial(b)
\end{align*}
Now, we have that $\varepsilon(f-g-K\partial)(b) = \varepsilon(f-g)(b) - \varepsilon h(f-g-K)(\partial b) = 0$. Additionally, we have that 
\[h\partial (f-g-K\partial)(b) = h(f\partial-g\partial-\partial K\partial - K\partial\partial)(b) = h(f-g-\partial K - K\partial)(\partial b),
\] 
which vanishes by induction hypothesis. Therefore we are left with
\begin{align*}
    \id_C(f-g-K\partial)(b)+K\partial(b) &= (f-g)(b) \qedhere
\end{align*}
\end{proof}

\subsection{Closed form formula for $K$}

We can apply this lemma to find the required homotopy $K$. For that we consider the non-equivariant homotopy $h\colon N_*EC_r\otimes N_*EC_r\to EC_r\otimes N_*EC_r\otimes N_*EC_r$ given by $h((a_0,\ldots,a_j)\otimes(b_0,\ldots,b_k)) = (0,a_0,\ldots,a_j)\otimes(b_0,\ldots,b_k)$, which is a contraction to the endomorphism $c$ of $N_*EC_r\otimes N_*EC_r$ that sends $a\otimes b$ to $0\otimes b$ in degree $0$ and all other generators are sent to zero. Since $f(e_0) = g(e_0)$, it holds that $c(f-g) = 0$. In addition $c\circ h = 0$, since $c$ vanishes in positive degrees. We claim that the homotopy $K$ so defined as the following form: We assume $j,k>0$, and denote by $s_q^-$ the entry to the left of the entry $s_q$. Explicitely, we have
\begin{align*}
	s_q^- &= \begin{cases}s_{q-1}+1 & \text{if $q>1$}\\
		s_q^- = 0 & \text{ if $q=1$ and even degree} \\
		s_q^- = 1 &\text{ if $q=1$ and odd degree.}
	\end{cases}
\end{align*}
The condition $s_q^-<s_q<t_1<s_q^-$ makes sense with the cyclic order in $\{0,1,\ldots,p-1\}$. In the following sums, we are suming along all possible values of $s_1,\ldots,s_j,t_1,\ldots,t_k$ in $\{0,1,\ldots,p-1\}$.
\begin{align*}
	K(e_{2i}) &= \sum_{j+k = i+1}{\sum_{q=1}^j{\sum_{s_q^-<s_q<t_1<s_q^-}{(0,s_1,s_1+1,\ldots,s_j,s_j+1)\otimes(t_1,t_1+1,\ldots,t_k,t_k+1)}}} \\
	K(e_{2i+1}) &= -\sum_{j+k = i+1}{\sum_{q=1}^j{\sum_{s_q^-<s_q<t_1<s_q^-}{(0,1,s_1,s_1+1,\ldots,s_j,s_j+1)\otimes(t_1,t_1+1,\ldots,t_k,t_k+1)}}}
\end{align*}

Let us check these formulae inductively.
\begin{align*}
	K(e_{2i+1}) &= h(f(e_{2i+1})-g(e_{2i+1})-K(\bd(e_{2i+1})))
\end{align*}
Now, all the summands in $f(e_{2i+1})$ and $g(e_{2i+1})$ start with a zero, therefore we are left with
\[K(e_{2i+1}) = -h(K(\rho e_{2i}))+h(K(e_{2i}))\]
and the second summand is zero, while the first one agrees with the definition of $K(e_{2i+1})$.

\begin{align*}
	K(e_{2i}) &= h(f(e_{2i})-g(e_{2i})-K(\bd(e_{2i})))
\end{align*}
Here, the summand $h(g(e_{2i}))$ is zero, the summand $K(\bd(e_{2i}))$ corresponds to the summation with $q>1$ and the summand $h(f(e_{2i}))$ corresponds to the summations with $q=1$.


\subsection{Lower and upper case maps}

It is immediate that
\[
\chains\EE f = F_\psi^r
\]
and that the composition
\[
H_{\psi,3}^r \colon \cW(r) \xra{\psi(r)} \cE(r) \xra{\psi^2_0 \ot \Delta_{\mathrm{SHI}}} \cE(2) \ot \cE(r)^{\ot 2} \xra{\bcirc_{\cE}} \cE(2r)
\]
is a $\cyc_r$-equivariant chain homotopy between $\chains\EE g$ and $\widetilde G_\psi^p$.

\subsection{Main construction}

\begin{theorem}
	For any algebra over the Barratt--Eccles operad $\phi \colon \cE \to \End(A)$, the map $H_\psi = \phi \circ (H_{\psi,1} + H_{\psi,2} + H_{\psi,3})$ is a Cartan relator for $(A,\psi)$.\todo{Maybe the signs are not right here.}
\end{theorem}

\subsection{Examples}

We now show some examples computed using the specialized computer algebra system \texttt{ComCH} \cite{medina2021comch} when $A$ is given by the normalized cochains of a standard simplex, and $\phi$ is the $\cE$-algebra structure of Berger and Fresse.
